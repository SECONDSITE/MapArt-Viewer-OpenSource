<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
		<html xmlns="http://www.w3.org/1999/xhtml"
		  <head>
		    <title>Demo</title>
		    <meta http-equiv='imagetoolbar' content='no'/>
<!-- //MARKER4: Below: changed map height to 500px and added "footer" div; removed "width:100%" and "height:100%" and "overflow:hidden" from html/body divs -->
		    <style type="text/css"> v\:* {behavior:url(#default#VML);}
		        html, body { padding: 0; font-family: 'Lucida Grande',Geneva,Arial,Verdana,sans-serif; }
		        body { margin: 10px; background: #fff; overflow-y:scroll; }
		        h1 { margin: 0; padding: 6px; border:0; font-size: 20pt; }
		        #header { height: 43px; padding: 0; background-color: #eee; border: 1px solid #888; }
		        #subheader { height: 12px; text-align: right; font-size: 10px; color: #555;}
      	    </style>
		    <script src="OpenLayers-2.11/lib/OpenLayers.js" type="text/javascript"></script>
		<script src="jquery-1.4.2.min.js" type="text/javascript"></script>
		<script src="jquery.contextMenu.js" type="text/javascript"></script>
		<link href="jquery.contextMenu.css" rel="stylesheet" type="text/css" />
            <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css" rel="stylesheet" type="text/css"/> 
            <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script> 

               
<style type="text/css">
    #sortable
	{
        list-style-type: none;
        margin: 0;
        padding: 0;
        width: 100%;
    }
	
    #sortable li
	{
        margin: 0 3px 3px 3px;
        padding: 0.4em;
        padding-left: 1.5em;
    }
	
    #sortable li span
	{
        position: absolute;
        margin-left: -1.3em;
    }
</style>                    

<script type="text/javascript">
  
     $(function() {
        $("#sortable").sortable({
            placeholder: 'ui-state-highlight',
            stop: function(i) {
               placeholder: 'ui-state-highlight'
				var indexCount=0;
				//Iterate through all of the "li"`s in the document.
               $('li').each(function(index) {
				    //A layer will have a name like 'Layer "myLayer"'. Here, we do some text processing to get just the layername ('myLayer')
					var text2 = $(this).text().substring($(this).text().indexOf("Layer \"")+7, $(this).text().length-$(this).text().indexOf("Layer \""));
					var text3 = text2.substring(0, text2.indexOf("\""));
console.log("text3: "+text3);
					//If this is a layer (that is, the layername was found and is therefore a non-zero string)...
					if(window.opener.map.getLayersByName(text3).length>0)
					{
						//Get the actual layer object (instead of the "li")
						var thisLayer = window.opener.map.getLayersByName(text3)[0];
						//Set the zIndex, counting down. We're moving through the "li"`s from the top of the document, which
						// means that layers whose "li" are literally higher in the document have a higher z index. This is the
						// logic behind the sortable list.
						window.opener.map.getLayersByName(text3)[0].setZIndex(window.opener.overlays.length-indexCount);
						/*
						//There is an OpenLayers quirk (bug?) wherein we can't change the baselayer without some strange
						//  behaviors. So this part has been removed (this is the same reason we've included a non-visible
						//  base layer on map creation.)
						if(indexCount ==$('li').length-1)
						{
							console.log("IndexCount: "+indexCount+"-- setting "+text3+" as baselayer");
							//Set baselayer here.
						}
						*/
					}
					else
					{
						//We've removed this, and now we're doing nothing. Remember, not all "li"`s are layers, so we can safely skip over some
						//  by doing nothing here.
						;
					}
					indexCount++;
               });
            }
        });
     });
</script>

<script type="text/javascript">
	function setOpacity(r)
	{
		overlays.setOpacity(r);
		overlays.setVisibility(true);
	}

	function slideOpacity(event, ui, tmsnum)
	{
		if(document.getElementById("checkbox" + tmsnum).checked==true)
		{
			window.opener.overlays[tmsnum].setOpacity(ui.value/100);
		}
		updateAll(tmsnum, ui.value);
	}
	
	function inputOpacity(tmsnum)
	{
		var value = parseFloat(document.getElementById("opacity" + tmsnum).value);
		if(document.getElementById("checkbox" + tmsnum).checked==true)
		{
			window.opener.overlays[tmsnum].setOpacity(value/100);
		}
		updateAll(tmsnum, value);
	}
	
	function updateAll(tmsnum, value)
	{
		document.getElementById("opacity" + tmsnum).value=value;
		window.opener.document.getElementById("opacity" + tmsnum).value=value;
		window.opener.changeSlider("#slider" + tmsnum,value);
		$("#slider" + tmsnum).slider("value", value);
	}
	
	function centerMap()
	{
		var centerLat = ( + 34) / 2;
		var centerLon = (-86 + ) / 2;		
		var center = new OpenLayers.LonLat(centerLon, centerLat);
		window.opener.map.setCenter(center, window.opener.map.zoom, true, false);
	}

	function switchLayer(tmsnum)
	{
		if(document.getElementById("checkbox" + tmsnum).checked==true)
		{
			var value = parseFloat(document.getElementById("opacity" + tmsnum).value);
			window.opener.overlays[tmsnum].setOpacity(value/100);
			window.opener.document.getElementById("checkbox" + tmsnum).checked = true;
		}
		else
		{
			window.opener.overlays[tmsnum].setOpacity(0);
			window.opener.document.getElementById("checkbox" + tmsnum).checked = false;
		}
	}
	
	function init()
	{
if(window.opener.document.getElementById("checkbox1").checked == false) {document.getElementById("checkbox1").checked = false;}
document.getElementById("opacity1").value = window.opener.document.getElementById("opacity1").value;
var lastItem = "";
		var thisItem = "";
		var indexCount = 0;
		$('li', window.opener.document).each(function(index)
		{
			if(indexCount > 0)
			{
				lastItem = thisItem;
			}
			thisItem = $(this).attr("id");
			if(indexCount > 0)
			{
				$('#'+thisItem).insertAfter($('#'+lastItem));
			}
			indexCount++;
		});
		window.opener.document.dimensionout = document.getElementById('output');
	}
</script>
</head>
<body onload="init()" onunload="window.opener.redockComponent()">
<div id="footer"><center>
<style type="text/css">
#slider1 { margin: 10px; width: 90%;}
</style> 
<script type="text/javascript">
$(document).ready(function() {
		$("#slider1").slider({step:0.1, slide:function(event, ui){ slideOpacity(event, ui, 1); }, stop:function(event, ui){ slideOpacity(event, ui, 1);}, value:100});
	});
</script>
    
    <style>ul {list-style-type: none;}</style>
    <div id="options" style="text-align:left;">
        <ul id="controlToggle">
            <li>
                <input type="radio" name="type" value="none" id="noneToggle" onclick="window.opener.toggleControl(this); window.opener.document.getElementById('noneToggle').checked='checked'" />
                <label for="noneToggle">navigate</label> <script>if(window.opener.document.getElementById('noneToggle').checked) {document.getElementById('noneToggle').checked = 'checked';}</script>
            </li>
	    <li>
		<button type="button" id="centerButton" style="display:inline;" onclick="centerMap()">Center Map</button>                            
	    </li>
            <li>
                <input type="radio" name="type" value="line" id="lineToggle" onclick="window.opener.toggleControl(this); window.opener.document.getElementById('lineToggle').checked='checked'" />
                <label for="lineToggle">measure distance</label> <script>if(window.opener.document.getElementById('lineToggle').checked) {document.getElementById('lineToggle').checked = 'checked';}</script>
            </li>
            <li>
                <input type="radio" name="type" value="measurePolygon" id="polygonToggle" onclick="window.opener.toggleControl(this); window.opener.document.getElementById('polygonToggle').checked='checked'" />
                <label for="polygonToggle">measure area</label> <script>if(window.opener.document.getElementById('polygonToggle').checked) {document.getElementById('polygonToggle').checked = 'checked';}</script>
            </li>
        </ul>
    </div>
    
<ul id="sortable">
<li id='listItem1' class='ui-state-default'><span class='ui-icon ui-icon-arrowthick-2-n-s'></span>
    <input type="checkbox" id="checkbox1" value="checkbox1" checked="checked" onchange="switchLayer(1)" />Layer "MapArtImpressions_4.jpg"
    <table width="100%">   
        <tr width="100%">
            <td>Opacity:</td>
            <td width="70%"><div id="slider1" display="inline-block"></div></td>
            <td><input type="text" id="opacity1" size="2" value="100"/>%&nbsp;&nbsp;&nbsp;<button id="changeOpacity1" onclick="inputOpacity(1)">Update</button></td>
        </tr>
    </table>
</li>
</ul>
</center></div>

<script>
window.innerHeight = document.documentElement.scrollHeight;
</script>					
</body>
</html>